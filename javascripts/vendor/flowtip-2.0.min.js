(function(){this.FlowTip=function(){function t(t){var i;null==t&&(t={}),this.visible=!1,this.target=null;for(i in t)_.has(t,i)&&void 0!==t[i]&&(this[i]=t[i])}return t.prototype.FlowTip="2.0",t.prototype.className="",t.prototype.contentClassName="",t.prototype.tailClassName="",t.prototype.appendTo=null,t.prototype.tooltipContent=null,t.prototype.region="top",t.prototype.topDisabled=!1,t.prototype.bottomDisabled=!1,t.prototype.leftDisabled=!1,t.prototype.rightDisabled=!1,t.prototype.hideInDisabledRegions=!1,t.prototype.persevere=!1,t.prototype.hasTail=!0,t.prototype.width=null,t.prototype.height="auto",t.prototype.minWidth=null,t.prototype.minHeight=null,t.prototype.maxWidth=null,t.prototype.maxHeight=null,t.prototype.tailWidth=20,t.prototype.tailHeight=10,t.prototype.animated=!1,t.prototype.targetOffset=10,t.prototype.targetOffsetFrom="root",t.prototype.edgeOffset=30,t.prototype.rotationOffset=30,t.prototype.targetAlign="center",t.prototype.targetAlignOffset=0,t.prototype.rootAlign="center",t.prototype.rootAlignOffset=0,t.prototype.render=function(){return this.$root?this._renderContent():(this.root=document.createElement("div"),this.root.className="flowtip "+this.className,this.root.style.position="absolute",this.root.style.display="none",this.content=document.createElement("div"),this.content.className="flowtip-content "+this.contentClassName,this._renderContent(),this._repositionCount=0,this.root.appendChild(this.content),this.tail=document.createElement("div"),this.tail.className="flowtip-tail "+this.tailClassName,this.tail.style.position="absolute",this.tail.appendChild(document.createElement("div")),this.root.appendChild(this.tail),this.$root=$(this.root),this.$content=$(this.content),this.$tail=$(this.tail),this.$appendTo=$(this.appendTo||(this.appendTo=document.body)),this.appendTo=this.$appendTo[0],this._insertToDOM())},t.prototype.setAppendTo=function(t){return this.$appendTo=$(t),this.appendTo=this.$appendTo[0],this.$root?this._insertToDOM():void 0},t.prototype.setTarget=function(t){return this.$target=$(t),this.target=this.$target[0]},t.prototype.setTooltipContent=function(t,i){return null==i&&(i={}),this.tooltipContent=t,i.render?this.render():void 0},t.prototype.reposition=function(){return this.target?(this.$root.width(this.width),this.$root.height(this.height),this.$root.css({minWidth:this.minWidth,minHeight:this.minHeight,maxWidth:this.maxWidth,maxHeight:this.maxHeight}),("auto"===this.width||"auto"===this.height)&&(this.content.style.position="relative"),this.$tail.width(this.tailWidth),this.$tail.height(this.tailHeight),this._updateRegion(),this._updatePosition()):void 0},t.prototype.show=function(){var t=this;if(!this.visible)return this.render(),this.visible=!0,this.root.style.opacity=0,this.root.style.display="block",_.delay(function(){return t.reposition(),t.root.style.opacity=1,t.animated&&t.$root.addClass("animated"),t.trigger("show")},16)},t.prototype.hide=function(){return this.visible?(this.visible=!1,this.root.style.display="none",this.trigger("hide"),this.$root.removeClass("animated")):void 0},t.prototype.trigger=function(t){return this.$root.trigger(""+t+".flowtip")},t.prototype.destroy=function(){return this.$root?this.$root.remove():void 0},t.prototype._availableRegion=function(t){return!this[""+t+"Disabled"]},t.prototype._fitsInRegion=function(t){var i,e,o;switch(e=this._calculatePosition(t),o=this._rootDimension(),i=this._parentParameter(),t){case"top":return e.top-this.edgeOffset>=0;case"bottom":return e.top+o.height+this.edgeOffset<=i.height;case"left":return e.left-this.edgeOffset>=0;case"right":return e.left+o.width+this.edgeOffset<=i.width}},t.prototype._availableAndFitsIn=function(t,i,e){var o;return e||(e=t[0]),o=t[0],!t||t.length<=0?this.hideInDisabledRegions?e:this._region:i[o].availables&&i[o].fits?o:this._availableAndFitsIn(t.slice(1),i,e)},t.prototype._updateRegion=function(){var t,i,e,o,s,h;return this._region||(this._region=this.region),this.persevere&&(this._region=this.region),t=this._parentParameter(),o=this._targetParameter(),i=this._regionParameter(),"top"!==this._region||i.top.fits?"bottom"!==this._region||i.bottom.fits?"left"!==this._region||i.left.fits?"right"!==this._region||i.right.fits||(this._region=this._availableAndFitsIn(["left","top","bottom"],i)):this._region=this._availableAndFitsIn(["right","top","bottom"],i):this._region=this._availableAndFitsIn(["top","left","right"],i):this._region=this._availableAndFitsIn(["bottom","left","right"],i),"top"!==(s=this._region)&&"bottom"!==s||i.top.fits||i.bottom.fits?"left"!==(h=this._region)&&"right"!==h||i.left.fits||i.right.fits||(this._region=this._availableAndFitsIn(["top","bottom"],i)):this._region=this._availableAndFitsIn(["left","right"],i),e=function(){switch(this._region){case"top":case"bottom":if(t.width-(o.left+o.width/2)-this.edgeOffset<this.rotationOffset)return"top"===this._region?["left","bottom"]:["left","top"];if(o.left+o.width/2-this.edgeOffset<this.rotationOffset)return"top"===this._region?["right","bottom"]:["right","top"];break;case"left":case"right":if(t.height-(o.top+o.height/2)-this.edgeOffset<this.rotationOffset)return"left"===this._region?["top","right"]:["top","left"];if(o.top+o.height/2-this.edgeOffset<this.rotationOffset)return"left"===this._region?["bottom","right"]:["bottom","left"]}}.call(this),e?this._region=this._availableAndFitsIn(e,i):void 0},t.prototype._updatePosition=function(t){var i,e,o,s;return t=this._calculatePosition(this._region),this.root.style.top=""+(Math.round(t.top)+this.$appendTo.scrollTop())+"px",this.root.style.left=""+(Math.round(t.left)+this.$appendTo.scrollLeft())+"px",s=this.$root.height(),i=this.$content.height(),e=this.$content.outerHeight(!0),o=e-i,e>s&&(this.content.style.maxHeight=""+(s-o)+"px",this.$root.addClass("content-overflow")),this.hasTail?(this.tail.style.display="block",this.tail.style.top=""+Math.round(t.tail.top)+"px",this.tail.style.left=""+Math.round(t.tail.left)+"px",this.tail.style.width=""+t.tail.width+"px",this.tail.style.height=""+t.tail.height+"px",this.tail.className="flowtip-tail "+this.tailClassName+" "+this._tailType(this._region),this.root.className=this.root.className.replace(/tail-at-[\w]+/,""),this.root.className=""+this.root.className+" tail-at-"+this._tailType(this._region)):this.tail.style.display="none",this.root.style.opacity=this._availableRegion(this._region)?1:0},t.prototype._calculatePosition=function(t){var i,e,o,s,h,r,n,a;switch(s=this._rootDimension(),e=this._parentParameter(),a=this._targetParameter(),n=0,r=0,this.hasTail&&(h=this._tailDimension(t),n=h.width,r=h.height),o={},i="root"===this.targetOffsetFrom?this.targetOffset:"tail"===this.targetOffsetFrom?"top"===t||"bottom"===t?r+this.targetOffset:"left"===t||"right"===t?n+this.targetOffset:void 0:void 0,t){case"top":o={top:a.top-s.height-i,left:this._rootPivot(t,a,s),tail:{top:s.height}};break;case"bottom":o={top:a.top+a.height+i,left:this._rootPivot(t,a,s),tail:{top:-r}};break;case"left":o={top:this._rootPivot(t,a,s),left:a.left-s.width-i,tail:{left:s.width}};break;case"right":o={top:this._rootPivot(t,a,s),left:a.left+a.width+i,tail:{left:-n}}}switch(t){case"top":case"bottom":o.left<this.edgeOffset?o.left=this.edgeOffset:o.left+s.width>e.width-this.edgeOffset&&(o.left=e.width-s.width-this.edgeOffset);break;case"left":case"right":o.top<this.edgeOffset?o.top=this.edgeOffset:o.top+s.height>e.height-this.edgeOffset&&(o.top=e.height-s.height-this.edgeOffset)}return this.hasTail&&(o.tail=function(){switch(t){case"top":return{top:s.height,left:this._tailPivot(t,a,h,o)};case"bottom":return{top:-r,left:this._tailPivot(t,a,h,o)};case"left":return{top:this._tailPivot(t,a,h,o),left:s.width};case"right":return{top:this._tailPivot(t,a,h,o),left:-n}}}.call(this),o.tail.width=n,o.tail.height=r),o},t.prototype._insertToDOM=function(){var t;return t=this.$appendTo.css("position"),"relative"!==t&&"absolute"!==t&&"fixed"!==t&&(t="relative"),this.appendTo.style.position=t,this.appendTo.appendChild(this.root)},t.prototype._renderContent=function(){return"string"==typeof this.tooltipContent?$(this.content).html(this.tooltipContent):(this.$tooltipContent=$(this.tooltipContent),this.content.innerHTML="",this.$tooltipContent.length?this.content.appendChild(this.$tooltipContent[0]):void 0)},t.prototype._rootPivot=function(t,i,e){var o,s,h,r,n,a,l;return l=this._targetPivot(t,i),n=this._rootAlign(t),a=this._rootAlignOffset(t),"center"===n?(s="top"===t||"bottom"===t?l-e.width/2:"left"===t||"right"===t?l-e.height/2:void 0,o="top"===t||"right"===t?a:"bottom"===t||"left"===t?-a:void 0):"edge"===n&&(h="top"===t||"bottom"===t?[l,l-e.width]:"left"===t||"right"===t?[l,l-e.height]:void 0,r=a>=0,s="top"===t||"right"===t?r?h[1]:h[0]:"bottom"===t||"left"===t?r?h[0]:h[1]:void 0,o="top"===t||"right"===t?a:"bottom"===t||"left"===t?-a:void 0),s+o+this._targetAlignmentOffset(t,i)},t.prototype._tailPivot=function(t,i,e,o){var s,h,r;return r=this._targetPivot(t,i),h="top"===t||"bottom"===t?r-o.left-e.width/2:"left"===t||"right"===t?r-o.top-e.height/2:void 0,s=this._targetAlignmentOffset(t,i),h+s},t.prototype._targetPivot=function(t,i){var e,o,s,h,r;return h=this._targetAlign(t),r=this._targetAlignOffset(t),"center"===h?e="top"===t||"bottom"===t?i.left+i.width/2:"left"===t||"right"===t?i.top+i.height/2:void 0:"edge"===h&&(o="top"===t||"bottom"===t?[i.left,i.left+i.width]:"left"===t||"right"===t?[i.top,i.top+i.height]:void 0,s=r>=0,e="top"===t||"right"===t?s?o[1]:o[0]:"bottom"===t||"left"===t?s?o[0]:o[1]:void 0),e},t.prototype._targetAlignmentOffset=function(t){var i,e,o;if(e=this._targetAlign(t),o=this._targetAlignOffset(t),"center"===e){if("top"===t||"right"===t)return o;if("bottom"===t||"left"===t)return-o}else if("edge"===e){if(i=o>=0,"top"===t||"right"===t)return-o;if("bottom"===t||"left"===t)return o}},t.prototype._rootAlign=function(t){return this[""+t+"RootAlign"]||this.rootAlign},t.prototype._rootAlignOffset=function(t){return this[""+t+"RootAlignOffset"]||this.rootAlignOffset},t.prototype._targetAlign=function(t){return this[""+t+"TargetAlign"]||this.targetAlign},t.prototype._targetAlignOffset=function(t){return this[""+t+"TargetAlignOffset"]||this.targetAlignOffset},t.prototype._rootDimension=function(){return{width:this.$root.width(),height:this.$root.height()}},t.prototype._tailDimension=function(t){var i,e,o;return i=this.tail.getAttribute("original-width")&&this.tail.getAttribute("original-height")?{width:parseInt(this.tail.getAttribute("original-width")),height:parseInt(this.tail.getAttribute("original-height"))}:(this.tail.setAttribute("original-width",o=this.$tail.width()),this.tail.setAttribute("original-height",e=this.$tail.height()),{width:o,height:e}),"left"===t||"right"===t?{width:i.height,height:i.width}:i},t.prototype._tailType=function(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"left":return"right";case"right":return"left"}},t.prototype._targetParameter=function(){var t,i;return i=this.$target.offset(),t=this.$appendTo.offset(),{top:i.top-t.top,left:i.left-t.left,height:this.$target.outerHeight(),width:this.$target.outerWidth()}},t.prototype._parentParameter=function(){var t;return t=this.$appendTo.offset(),{top:t.top,left:t.left,height:this.$appendTo.outerHeight(),width:this.$appendTo.outerWidth()}},t.prototype._regionParameter=function(){return{top:{fits:this._fitsInRegion("top"),availables:this._availableRegion("top")},bottom:{fits:this._fitsInRegion("bottom"),availables:this._availableRegion("bottom")},left:{fits:this._fitsInRegion("left"),availables:this._availableRegion("left")},right:{fits:this._fitsInRegion("right"),availables:this._availableRegion("right")}}},t}()}).call(this);
